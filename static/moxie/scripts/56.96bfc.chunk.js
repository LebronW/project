webpackJsonp([56],{224:function(e,t,a){try{(function(){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(2),r=l(n),s=a(1),o=a(9),i=a(8),u=l(i),d=a(4),f=l(d),c=a(15),m=l(c),p=a(10),h=l(p),g=a(13),y=l(g),E=a(5),v=l(E),b=a(18),T=l(b),S=a(6),I=l(S),N=a(7),k=l(N),P=a(41),_=l(P),x=r.default.createClass({displayName:"ImportForm",propTypes:{pageConfig:n.PropTypes.object.isRequired},getInitialState:function(){return{phoneInfo:null,isStart:!1,defaultPolicyNum:"",defaultIdNo:"",Type:"password",bgImg:"url("+a(20)+")",frontConf:this.props.frontConf}},getDefaultProps:function(){return{title:""}},componentDidMount:function(){},componentWillUnmount:function(){this.unmount=!0},render:function(){var e=(this.handleForget,this.handleImport),t=(this.handleProtocol,this.state),a=t.isStart,l=(t.defaultIdNo,t.defaultPolicyNum,this.props.title),n=this.props.pageConfig,o=r.default.createElement(k.default,{onTap:u.default.bind(this,null)},r.default.createElement("i",{className:"ion-chevron-left"})),i=(r.default.createElement(I.default,{title:l,left:o}),this.props.params.insuranceId||s.qsParams.insurance_id),d=[];d=JSON.parse(n);var f=[];s.qsParams.agreementEntryText||this.state.frontConf.agreementEntryText||"同意《用户使用协议》",f.push(r.default.createElement("div",{className:"centerImgDiv-lifeinsr"},r.default.createElement("div",{className:"centerImg-type3 i-"+i})));for(var c=0;c<d.length;c++)if("text"==d[c].type){var p="",g=m.default.get("lifeinsr",0,0,i);g&&g.loginParam&&(p=g.loginParam[d[c].code]),f.push(r.default.createElement("div",{key:d[c].code,className:"input-item"},r.default.createElement(y.default,{type:"text",ref:d[c].code,id:d[c].code,defaultValue:p,placeholder:"请输入"+d[c].name,label:d[c].name}),r.default.createElement("div",{onClick:this.clearValue.bind(this,"#"+d[c].code),className:"tex_box name"},r.default.createElement("span",{className:"textt"}))))}else if("password"==d[c].type)f.push(r.default.createElement("div",{key:d[c].code,className:"input-item"},r.default.createElement(y.default,{type:this.state.Type,ref:d[c].code,id:d[c].code,placeholder:"请输入"+d[c].name,label:d[c].name}),r.default.createElement(h.default,{onTap:this.showPwd},r.default.createElement("div",{className:"tex_box name"},r.default.createElement("span",{style:{backgroundImage:this.state.bgImg},className:"password password_show"})))));else if("select"==d[c].type){var p="",g=m.default.get("lifeinsr",0,0,i);g&&g.loginParam&&(p=g.loginParam.idno);for(var E=d[c].name.split(","),b=d[c].value.split(","),S=[],N=0;N<E.length;N++)S.push(r.default.createElement("option",{value:b[N]},E[N]));var P=r.default.createElement("select",{defaultValue:b[0],id:"policynumSelect"},S);f.push(r.default.createElement("div",{key:d[c].code,className:"input-item"},r.default.createElement(y.default,{type:"text",ref:d[c].code,id:d[c].code,defaultValue:p,placeholder:"请输入"+d[c].name.replace(",","或"),label:P}),r.default.createElement("div",{onClick:this.clearValue.bind(this,"#"+d[c].code),className:"tex_box name"},r.default.createElement("span",{className:"textt"}))))}var x=r.default.createElement("div",null,r.default.createElement("div",{className:"form common-form"},f),r.default.createElement(_.default,{ref:"agreementField",uid:"0",frontConf:this.state.frontConf}),r.default.createElement("div",{className:"page-wrapper"},r.default.createElement(h.default,{onTap:e},r.default.createElement(v.default,{types:"full",onTap:function(){},disable:a,state:a,getState:function(e){switch(e){case!1:return"提交";case!0:return"登录中...";default:return"提交"}}}))));return r.default.createElement("div",null,r.default.createElement(T.default,null,x))},clearValue:function(e){document.querySelector(e).parentNode.querySelector("input").value=""},handleImport:function(){var e=this;if(!this.refs.agreementField.isChecked(P.AGREEMENT_TYPE.MOXIE))return void setTimeout(function(){return f.default.alert("请勾选同意《用户使用协议》","")});if(!this.refs.agreementField.isChecked(P.AGREEMENT_TYPE.TENANT))return void setTimeout(function(){return f.default.alert("请勾选同意《用户使用协议》","")});for(var t=this.props,a=t.pageConfig,l=t.onSubmitTaskDone,n={},r=JSON.parse(a),i=0;i<r.length;i++){if(!this.refs[r[i].code].getValue())return setTimeout(function(){return f.default.alert("请填写完整的信息")}),!1;"text"==r[i].type?n[r[i].code]=this.refs[r[i].code].getValue():n.idno=this.refs.login_type&&this.refs.login_type.getValue()||this.refs.idno&&this.refs.idno.getValue()}this.state.phoneInfo,this.setState({isStart:!0});var u="1";null!=document.getElementById("policynumSelect")&&(u=document.getElementById("policynumSelect").value);var d=this.props.params.insuranceId||s.qsParams.insurance_id,c=void 0;n.taskSubType=d,n.loginType=u,n.taskType="lifeinsr",n.username=n.policynum,(0,o.submitTaskHelper)(n).then(function(t){if(c=t,t.body.task_id){e.setState({isStart:!1}),f.default.refreshStatus("2","创建任务成功"),f.default.mxSaveTaskId(t.body.task_id);var a={taskId:t.body.task_id,mappingId:t.body.mapping_id,bankId:e.props.params.insuranceId,username:e.refs.login_type?e.refs.login_type.getValue():e.refs.idno.getValue(),taskType:"lifeinsr",taskSubType:d,loginParam:{policynum:e.refs.policynum?e.refs.policynum.getValue():null,idno:e.refs.idno&&e.refs.idno.getValue()||e.refs.login_type&&e.refs.login_type.getValue()}};l(a)}}).catch(function(t){console.log(t),e.setState({isStart:!1});var a=t&&t.response&&t.response.body||{};a.errors&&a.errors[0]&&(10220011===a.errors[0].code||10220012===a.errors[0].code)?(f.default.refreshStatus("-2",a.errors[0].message),e.showUnsupport(a.errors[0].message)):(f.default.refreshStatus("-3","服务异常，创建任务失败"),e.handleError(t,a.detail))})},handleError:function(e){var t=arguments.length<=1||void 0===arguments[1]?"任务提交失败":arguments[1];try{t=e&&e.body&&e.body.detail||t}catch(e){}if("任务提交失败"==t){if(e&&e.message&&e.message.indexOf("the network is offline")!=-1)return void f.default.alert("网络开小差啦，请稍后再试");f.default.alert(t+"\n"+e)}else f.default.alert(t);this.setState({isStart:!1})},handleTanentProtocol:function(){var e=s.qsParams.tenantAgreementUrl||this.state.frontConf.tenantAgreementUrl;f.default.openWebView("用户使用协议",e,"","agreement")},showPwd:function(){"text"==this.state.Type?this.setState({Type:"password",bgImg:"url("+a(20)+")"}):this.setState({Type:"text",bgImg:"url("+a(37)+")"})},handleProtocol:function(){var e=s.qsParams.agreementUrl||this.state.frontConf.agreementUrl;f.default.openWebView("用户使用协议",e,"","agreement")},autoImport:function(){this.props.auto&&this.handleImport()}});t.default=x,e.exports=t.default}).call(this)}finally{}}});